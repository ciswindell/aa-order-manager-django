# PRD: Order Data Models (Phase 1)

## Introduction/Overview

The Order Data Collection Platform requires robust data structures to represent order information and order item details throughout the automated workflow system. This feature establishes the foundational data models that will support the transformation from manual worksheet generation to automated data collection workflows.

The current system processes order items individually with basic data structures. The new models will support comprehensive order-level tracking, detailed order item metadata, workflow-generated data, and collection status tracking across multiple agencies (NMSLO and Federal).

## Goals

1. **Establish Comprehensive Data Models**: Create OrderData and OrderItemData classes that support both current and future workflow requirements
2. **Enable Workflow Integration**: Design models that can capture data generated by automated workflows
3. **Support Multiple Output Formats**: Ensure models can be serialized to JSON and converted to Excel worksheets
4. **Maintain Agency Flexibility**: Handle agency-specific fields (particularly NMSLO lease index requirements)
5. **Track Collection Metadata**: Capture errors, timestamps, and completion status for each workflow step

## User Stories

**As a data collection platform**, I want to:
- Store order-level information (order number, date, type, notes, delivery link) so that multiple order items can be grouped and tracked together
- Track individual order item details (agency, lease number, legal description, date range) to maintain user input data
- Capture workflow-generated data (directory links, previous reports found, document locations) to provide comprehensive automation results
- Store collection metadata (errors, timestamps, completion status) to enable progress tracking and error reporting
- Serialize data to JSON format to support API integrations and data persistence
- Convert data to Excel worksheet format to maintain backward compatibility with current output requirements

**As a developer implementing workflows**, I want to:
- Access a clean data model interface to populate workflow results without knowing output format details
- Handle agency-specific data requirements (NMSLO lease index) through the same model interface
- Track partial completion states when some workflows succeed and others fail

## Functional Requirements

### Core Data Models

1. **OrderData Class**: The system must provide an OrderData class with the following fields:
   - `order_number` (string): Unique identifier for the order
   - `order_date` (date): Date the order was created
   - `order_type` (string): Type/category of the order
   - `notes` (string, optional): Additional order-level notes
   - `delivery_link` (string, optional): Link for order delivery
   - `order_items` (list): Collection of OrderItemData objects

2. **OrderItemData Class**: The system must provide an OrderItemData class with the following sections:

   **User Input Fields**:
   - `agency` (string): NMSLO or Federal
   - `lease_number` (string): Lease identifier
   - `legal_description` (string): Legal description of the lease
   - `date_range` (string): Date range for the order item

   **Workflow-Generated Fields**:
   - `report_directory_link` (string, optional): Link to main lease directory
   - `previous_report_found` (boolean): Whether existing reports were detected
   - `documents_link` (string, optional): Link to documents subdirectory
   - `lease_index_link` (string, optional): Link to lease index directory (NMSLO only)

   **Collection Metadata**:
   - `errors` (list): Collection of error messages from workflow execution
   - `timestamps` (dict): Start/end times for each workflow step
   - `completion_status` (string): Overall completion status (pending, in_progress, completed, failed)
   - `workflow_status` (dict): Individual workflow completion status

### Data Operations

3. **JSON Serialization**: Both OrderData and OrderItemData classes must provide methods to serialize to JSON format with proper handling of date/datetime objects

4. **Worksheet Conversion**: OrderItemData must provide methods to convert data to the existing Excel worksheet format for backward compatibility

5. **Data Validation**: The system must validate required fields and data types during object construction

6. **Agency-Specific Handling**: The system must handle NMSLO-specific fields (lease_index_link) without breaking Federal order processing

### Error Handling

7. **Graceful Degradation**: Models must handle partial data population when some workflows fail
8. **Error Collection**: Models must aggregate errors from multiple workflow steps
9. **Status Tracking**: Models must track completion status at both order and order item levels

## Non-Goals (Out of Scope)

- **Workflow Implementation**: This phase does not implement the actual workflow logic
- **Database Persistence**: Models will not include database storage capabilities
- **Configuration Integration**: Configuration system integration is handled in Phase 5
- **GUI Integration**: User interface updates are handled in Phase 7
- **Output Strategy Implementation**: Multiple output format strategies are handled in Phase 6

## Design Considerations

- **Immutable Design**: Consider using dataclasses or similar patterns for data integrity
- **Type Hints**: Use comprehensive type hints for better IDE support and documentation
- **Extensibility**: Design models to accommodate future workflow types and agency requirements
- **Backward Compatibility**: Ensure existing worksheet generation continues to work unchanged

## Technical Considerations

- **Location**: Implement in `src/core/models.py` alongside existing model classes
- **Dependencies**: Minimal external dependencies; use standard library for JSON serialization
- **Testing**: Create comprehensive unit tests in `tests/core/test_models.py`
- **Integration**: Models should integrate cleanly with existing processor classes
- **Documentation**: Include docstrings and examples for all public methods

## Success Metrics

1. **Functional Completeness**: All required fields are properly modeled and accessible
2. **Serialization Success**: 100% successful JSON serialization/deserialization round trips
3. **Worksheet Compatibility**: Existing Excel worksheet generation continues to work without modification
4. **Test Coverage**: Achieve 100% unit test coverage for all model classes and methods
5. **Developer Experience**: Models provide clear, intuitive interfaces for workflow implementations

## Open Questions

1. **Default Values**: Should workflow-generated fields have specific default values or remain None until populated?
2. **Validation Rules**: What specific validation rules should be applied to user input fields (lease numbers, legal descriptions)?
3. **Error Format**: Should errors be stored as simple strings or structured error objects with codes and metadata?
4. **Timestamp Granularity**: Should timestamps track workflow start/end times, or more granular step-by-step progress?
5. **Status Enum**: Should completion status use string values or enum constants for better type safety?